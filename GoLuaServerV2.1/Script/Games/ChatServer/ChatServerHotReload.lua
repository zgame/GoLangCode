---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by soonyo.
--- DateTime: 2019/11/13 14:34

--- 处理聊天服热更新相关

--- 热更新
function ChatServerReload()
    local oldchatInstance = ChatServerLogicInstance
    Logger(string.format("ChatServerReload  oldchatInstance 地址: %x" ,oldchatInstance))
    for _,module in pairs(RequireAndReloadChatServerFiles) do
        ReloadFile(module)
    end
    ChatServerLogicInstance = oldchatInstance
    ChatServerLogic:Reload(oldchatInstance)
end


--- 外部接口热更新
function ChatServerLogic:Reload(o)
    -- 设置元表(这样才可以调用新增的函数)
    G_SetMetaTable(o,self)
    --- UserMgr 加载数据
    ChatUserManager:Reload(self.UserMgr)
    --- FriendMgr 重新加载数据
    ChatFriendManager:Reload(self.FriendMgr)
    ---连接信息
    --if self.m_LinkInfo ~= nil and next(self.m_LinkInfo) ~= nil then
    --    for i,linkInfo in pairs(self.m_LinkInfo) do
    --        ChatLinkInfo:Reload(self.m_LinkInfo[i])
    --    end
    --end

    if self.m_WillSaveMessagelist ~= nil and next(self.m_WillSaveMessagelist) ~= nil then
        for i,willSaveMessage in pairs(self.m_WillSaveMessagelist) do
            ChatWillSaveMessage:Reload(self.m_WillSaveMessagelist[i])
        end
    end
    -- 如果热更新有改动成员变量的定义的话， 下面需要进行成员变量的处理
    -- 比如 1 增加了字段， 那么你需要将老数据进行， 新字段的初始化
    -- 比如 2 删除了字段， 那么你需要将老数据进行， 老字段=nil
    -- 比如 3 修改了字段， 那么你需要将老数据进行， 老字段=nil， 新字段初始化或者进行赋值处理
end