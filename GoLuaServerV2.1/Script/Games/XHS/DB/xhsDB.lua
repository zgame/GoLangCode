---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by soonyo.zhengxh
--- DateTime: 2019/10/28 10:20
---

--------------------------------------------------------------------------------------
--- 主要处理本游戏相关的数据库操作
--------------------------------------------------------------------------------------

--- 保存玩家小海兽信息
--- @param user 玩家User对象
--- @param bSummon 是否新召唤的海兽
function XhsTable:SaveSeaMonsterData(user, bSummon)
    -- 用户判定
    if user == nil then
        Logger("SaveSeaMonsterData user nil")
        return
    end
    if bSummon == nil then
        bSummon = false
    end
    -- 构建sql语句
    local sSql = ""
    if bSummon then
        sSql = string.format("UPDATE UserSeaMonster with(updlock) SET MosterID=%d,MosterHP=%d,ButtleNum=%d,"..
                "TotalCritNum=%d,StartDate=GETDATE() WHERE UserID=%d;",
                user.MonsterID,user.MonsterHP,user.MonsterBulletNum,user.TotalCritNum,user.UserID)
    else
        sSql = string.format("UPDATE UserSeaMonster with(updlock) SET MosterID=%d,MosterHP=%d,ButtleNum=%d,"..
                "TotalCritNum=%d WHERE UserID=%d;", user.MonsterID,user.MonsterHP,user.MonsterBulletNum,user.TotalCritNum,user.UserID)
    end
    -- 执行Sql
    SqlServerDataBaseBYExec(sSql)
end

--- 保存玩家拼图信息
--- @param user 玩家user对象
function XhsTable:SaveUserPuzzleInfo(user)
    -- 用户判定
    if user == nil then
        Logger("SaveUserPuzzleInfo user nil")
        return
    end
    -- 构建sql语句
    local strPuzzleInfo = ""
    for i, v in pairs(user.PuzzleIDArray) do
        strPuzzleInfo = string.format("%s%d,",strPuzzleInfo,v)
    end
    local sSql = string.format("Update UserSeaMonster with(updlock) Set Puzzle='%s' Where UserID=%d;",
            strPuzzleInfo, user.UserID)
    SqlServerDataBaseBYExec(sSql)
end